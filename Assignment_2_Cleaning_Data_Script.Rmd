---
title: "QMEE_Assignment2"
author: "Hayden Simm"
date: "2026-01-15"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# loading packages --------------------------------------------------------
suppressPackageStartupMessages(
  library(tidyverse)
  )
suppressPackageStartupMessages(
  library(respR)
  )
```

creating the dataframe
```{r}
df_fish <- read.delim("KILLIFISH_RESPIROMETRY_1.txt")
```
**BMB**: is there any way you can get these data in a saner format?
**response**: the software used to collect this info is called "pyroscience" 
  and the file outputs are supposed to be their own file types ".pyr", so yes 
  it is a mess and part of the reason I'm here!

remove the first rows which include device information
```{r}
df_fish<-df_fish[-c(0:141),] 
```

removing excess columns which we are not analyzing
**BMB**: better to do this by name (or string pattern) if possible
```{r}
df_fish <- df_fish[,c(3,4,22,40,58,81,99,117,135)]
```

#renaming columns to the instrument channel names
```{r}
df_fish <- df_fish %>%
  rename (time = 1,  A1 = 2,  A2 = 3,   A3 = 4,   A4 = 5,
          B1 = 6,    B2 = 7,  B3 = 8, B4 = 9)
```
**BMB** if you're going to rename **all** columns then `colnames(df_fish) <- c("time", paste0("A", 1:4), paste0("B", 1:4))` is better

#making values numeric for RespR because they are currently character
```{r}
str(df_fish) #returns that all columns are "chr"
df_fish_numeric <- df_fish [-1,]%>%
  mutate(across(everything(), as.numeric))
str(df_fish_numeric) #verifies everything is converted to "num"
```

#removing excess NAs from when data was stopped recording 
```{r}
df_fish_numeric[!complete.cases(df_fish_numeric), ] #identifies rows with NAs to check if they are in the 'core' of the data
df_fish_numeric <- df_fish_numeric %>% drop_na()
anyNA(df_fish_numeric) #confirm NAs were removed
```

#now the data set is clean and we can investigate it for problems
```{r}
summary(df_fish_numeric) #numerical way to identify minimum and maximum values are as expected, ~80-100 %air
plot(df_fish_numeric$time, df_fish_numeric$A1, type = "l", lwd = 2, col=1,
  xlab = "Time (s)", 
  ylab = "Oxygen concentration (%air)")
lines(df_fish_numeric$time, df_fish_numeric$A2, lwd = 2, col=2)
lines(df_fish_numeric$time, df_fish_numeric$A3, lwd = 2, col=3)
lines(df_fish_numeric$time, df_fish_numeric$A4, lwd = 2, col=4)
```

```{r}
## BMB: or this
matplot(df_fish_numeric$time, df_fish_numeric[2:5], lwd=2, col = 1:4, type = "l", lty = 1)
```

#pivoting the data to a format for an overlayed histogram
```{r}
df_fish_long <- df_fish_numeric %>%
  pivot_longer(cols = -time, names_to = "chamber", values_to = "percentair")

df_fish_long_A <- df_fish_long %>%
  filter(stringr::str_starts(chamber, "A")) #filtering out 4 chambers that were all at the same temperature and therefore more comparable

theme_set(theme_minimal())

ggplot(df_fish_long_A, aes(x = percentair, fill = chamber)) +
  geom_histogram(alpha = 0.4, bins = 40, position = "identity")

```

```{r}
ggplot(df_fish_long_A, aes(x=chamber, y = percentair/100.228)) + geom_violin(fill = "gray") +
  scale_y_continuous(trans = "logit", breaks = c(seq(0.8, 0.95, by = 0.05), seq(0.96, 0.99, by = 0.01),
                                                 seq(0.992, 0.998, by = 0.002)))
```
**BMB**: why does 'percent air' have values above 100 ???
```{r}
head(rev(sort(unique(df_fish_long_A$percentair))))
```

Save this cleaned data

```{r}
saveRDS(df_fish_numeric, file = "df_fish_numeric.rds")
saveRDS(df_fish_long, file = "df_fish_long.rds")
```
